---
title: "ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰æ¤œè¨¼ã™ã‚‹çŠ¶æ…‹é·ç§»ã®ç¤ºã—æ–¹"
emoji: "ğŸ’­" # ã‚¢ã‚¤ã‚­ãƒ£ãƒƒãƒã¨ã—ã¦ä½¿ã‚ã‚Œã‚‹çµµæ–‡å­—ï¼ˆ1æ–‡å­—ã ã‘ï¼‰
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢è¨˜äº‹
topics: ["è¨­è¨ˆ", "çŠ¶æ…‹é·ç§»å›³", "ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£å›³"] # ã‚¿ã‚°ã€‚["markdown", "rust", "aws"]ã®ã‚ˆã†ã«æŒ‡å®šã™ã‚‹
published: true # å…¬é–‹è¨­å®šï¼ˆfalseã«ã™ã‚‹ã¨ä¸‹æ›¸ãï¼‰
---

# ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰æ¤œè¨¼ã™ã‚‹çŠ¶æ…‹é·ç§»ã®ç¤ºã—æ–¹

## æœ¬ç¨¿ã®å†…å®¹
æœ¬ç¨¿ã§ã¯çŠ¶æ…‹é·ç§»å›³ã¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£å›³ã®ä½¿ã„åˆ†ã‘ã«ç€ç›®ã—ã€çŠ¶æ…‹é·ç§»ã§ç¤ºã™ã¹ãå†…å®¹ã‚’æ˜ç¢ºã«ã—ã¦ã„ãã¾ã™ã€‚

æœ¬ç¨¿ã®å¯¾è±¡ã¯æ¬¡ã®ã‚ˆã†ãªæ–¹ã§ã™
* çŠ¶æ…‹é·ç§»å›³ã¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£å›³ã®é•ã„ãŒåˆ†ã‹ã‚‰ãªã„ã€‚çŠ¶æ…‹é·ç§»å›³ã§ã™ã¹ã¦è¡¨ã›ã¦ã—ã¾ã†ã®ã§ã¯ãªã„ã‹ã¨æ€ã†ãŸã‚ä½¿ã„åˆ†ã‘ã‚’çŸ¥ã‚ŠãŸã„
* çŠ¶æ…‹é·ç§»å›³ã§ç€ç›®ã™ã¹ãã¯çŠ¶æ…‹ã ãŒãªãœçŠ¶æ…‹ã«ç€ç›®ã™ã¹ãã‹ãŒã™ã£ãã‚Šã—ãªã„ã®ã§ã€ã™ã£ãã‚Šã—ãŸã„

æ¬¡ã®å†…å®¹ã‚’ã¾ã¨ã‚ã¾ã™
* çŠ¶æ…‹é·ç§»å›³ã®ç¤ºã™ã¹ãå†…å®¹ã¨ã¯
  * ã€ŒçŠ¶æ…‹é·ç§»å›³ã€ã¨ã¯
  * ãªã«ã‚’ã©ã“ã¾ã§çŠ¶æ…‹é·ç§»å›³ã§ç¤ºã™ã¹ããªã®ã‹
* æ®‹å¿µãªçŠ¶æ…‹é·ç§»å›³ã®æ”¹å–„
  * ã©ã“ãŒæ®‹å¿µã§ã©ã†ã™ã‚Œã°è‰¯ã„ã®ã‹

ã¾ãšçŠ¶æ…‹é·ç§»å›³ã®ã‚ã‚‹ã¹ãå§¿ã‚’ç¢ºèªã—ã€ãã®å¾Œæ®‹å¿µçŠ¶æ…‹ã‚’è§£æ¶ˆã™ã‚‹ã“ã¨ã§çŠ¶æ…‹é·ç§»ã‚’ã©ã®ã‚ˆã†ã«ç¤ºã›ã°ã‚ˆã„ã®ã‹ã‚’è€ƒãˆã¦ã„ãã¾ã™

ãªãŠæœ¬è¨˜äº‹ã¯å‹•ç”»åŒ–ã‚‚ã—ã¦ã„ã¾ã™ã€‚èª­ã¿ä¸Šã’ã¦æ¬²ã—ã„ç³»ãªæ–¹ã¯ã©ã†ã

:::details å‹•ç”»
@[youtube](wGR9a0r_dMU)

:::

## ã“ã‚“ãªã‚·ã‚¹ãƒ†ãƒ ã‚’ä½œã‚ŠãŸã‹ã£ãŸ
ä»Šå›æ¬¡ã®ã‚ˆã†ãªã‚·ã‚¹ãƒ†ãƒ ã§è€ƒãˆã¦ã¿ã¾ã™

* ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯å‹•ã
  * å‹•ä½œé€Ÿåº¦ã¯2ç¨®é¡(æ™®é€š, é«˜é€Ÿ)
  * é«˜é€Ÿå‹•ä½œã«ã¯æ™‚é–“åˆ¶é™ã‚’ä»˜ã‘ã‚‹(ä»Šå›æ™‚é–“ã‚’åˆ¶é™ã™ã‚‹éƒ¨åˆ†ã¯å‰²æ„›ã—ã¦ã„ã¾ã™)
* ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯æ¬¡ã®3çŠ¶æ…‹ã‚’æŒã¤
  * éé«˜é€Ÿç§»å‹•ä¸­ï¼šé«˜é€Ÿç§»å‹•ã—ã¦ã„ãªã„
  * é«˜é€Ÿç§»å‹•ä¸­ï¼šé«˜é€Ÿç§»å‹•ã—ã¦ã„ã‚‹
  * å£æ¥è§¦ä¸­ï¼šå£ã«å½“ãŸã£ã¦ã„ã‚‹
* å£åˆ¤å®š, ç§»å‹•ã®ä»•çµ„ã¿ã¯æ—¢å­˜ã®ã‚‚ã®ã‚’æµç”¨ã—ãŸã„æ°—æŒã¡ãŒã‚ã‚‹
  * (ã ã‹ã‚‰å£çŠ¶æ…‹ã¨ç§»å‹•çŠ¶æ…‹ãŒåˆä½“ã—ã¤ã¤ã‚ã‚‹ã¨ã„ã†æƒ³å®š)
* ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå£ã«å½“ãŸã£ãŸéš›ã¯é«˜é€Ÿç§»å‹•çŠ¶æ…‹ã‚’è§£é™¤ã™ã‚‹

ä¸Šè¨˜ã‚·ã‚¹ãƒ†ãƒ ã®ã†ã¡ç§»å‹•å‡¦ç†, å£åˆ¤å®šã¾ã§ä½œã‚Šä¸Šã’ï¼Œå£ã«å½“ãŸã£ãŸéš›ã«è§£é™¤ã™ã‚‹ãŸã‚ã«ä»Šå›ã®3çŠ¶æ…‹ã‚’è€ƒãˆå‡ºã—ãŸã€‚ãã“ã®è¨­è¨ˆãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸­ã¨ã„ã†æƒ³å®šã§ã™

â€»ã‚‚ã£ã¨ç°¡ç´ ãªå®Ÿç¾æ–¹æ³•ãŒã‚ã‚‹ã¨ã‹ã€ãã‚‚ãã‚‚ãã®çŠ¶æ…‹ã‚’æŒãŸã›ã‚‹ã®ã¯ãŠã‹ã—ããªã„?ã¨ã‹ãã†ã„ã†è¦³ç‚¹ã‚‚ã‚ã‚‹ã®ã§ã™ãŒã€èª¬æ˜ã®ãŸã‚ã«ä½œã‚Šå‡ºã—ãŸå•é¡Œã§ã™ã€‚ã‚†ãˆã«è¨­å•ã«è‹¥å¹²ç„¡ç†ãŒã‚ã‚‹ã¨ã„ã†éƒ¨åˆ†ã¯ã”æ‰¿çŸ¥ãŠããã ã•ã„

## ã“ã‚“ãªçŠ¶æ…‹é·ç§»å›³ãŒã§ããŸ

:::details plantuml
```plantuml
[*] --> å£åˆ¤å®šç”¨ãƒ«ãƒ¼ãƒ—
å£åˆ¤å®šç”¨ãƒ«ãƒ¼ãƒ— --> å£åˆ¤å®š : ä½•ã‹ã«è§¦ã‚ŒãŸ

state å£åˆ¤å®š{
[*] --> æ¥è§¦å¯¾è±¡ã®åˆ¤å®š
æ¥è§¦å¯¾è±¡ã®åˆ¤å®š --> æ¥è§¦çŠ¶æ…‹ã‚’æ¥è§¦ä¸­ã«å¤‰æ›´ : å£ã§ã‚ã‚‹
æ¥è§¦çŠ¶æ…‹ã‚’æ¥è§¦ä¸­ã«å¤‰æ›´ : entry / çŠ¶æ…‹ã‚’å£æ¥è§¦çŠ¶æ…‹ã«å¤‰æ›´ã™ã‚‹
æ¥è§¦å¯¾è±¡ã®åˆ¤å®š --> å£åˆ¤å®šç”¨ãƒ«ãƒ¼ãƒ— : å£ã§ãªã„
æ¥è§¦çŠ¶æ…‹ã‚’æ¥è§¦ä¸­ã«å¤‰æ›´ --> å£åˆ¤å®šç”¨ãƒ«ãƒ¼ãƒ—
}

[*] --> ç§»å‹•ç”¨ãƒ«ãƒ¼ãƒ—
ç§»å‹•ç”¨ãƒ«ãƒ¼ãƒ— --> é«˜é€Ÿç§»å‹•å‡¦ç†

state é«˜é€Ÿç§»å‹•å‡¦ç† {
[*] --> å£æ¥è§¦çŠ¶æ…‹ã®åˆ¤å®š
å£æ¥è§¦çŠ¶æ…‹ã®åˆ¤å®š --> å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ã‚‹ : å£éæ¥è§¦çŠ¶æ…‹
å£æ¥è§¦çŠ¶æ…‹ã®åˆ¤å®š --> å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ãªã„ : å£æ¥è§¦çŠ¶æ…‹

å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ã‚‹ --> é«˜é€Ÿç§»å‹• : ã‚­ãƒ¼å…¥åŠ›ã•ã‚Œã¦ã„ã‚‹
é«˜é€Ÿç§»å‹• : entry / çŠ¶æ…‹ã‚’é«˜é€Ÿç§»å‹•ä¸­ã«ã™ã‚‹
é«˜é€Ÿç§»å‹• --> ç§»å‹•ç”¨ãƒ«ãƒ¼ãƒ—
å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ã‚‹ --> ç§»å‹•ç”¨ãƒ«ãƒ¼ãƒ— : ã‚­ãƒ¼å…¥åŠ›ã•ã‚Œã¦ã„ãªã„
å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ãªã„ --> ç§»å‹•ç”¨ãƒ«ãƒ¼ãƒ—
}
```
:::
![](/images/statemachine_from_antipattern/antistate.png)
ãªã‚“ã¨ãªãä¼ãˆãŸã„ã“ã¨ã¯ã‚ã‹ã‚Šã¾ã™ã€‚ã€‚ã€‚ãŒã€è¤‡é›‘ãªã‚·ã‚¹ãƒ†ãƒ ã«ãªã‚‹ã¨ã‚ã‹ã‚‰ãªããªã‚Šã¾ã™ã€‚

å›°ã£ã¦ã—ã¾ã„ã¾ã—ãŸ

## çŠ¶æ…‹é·ç§»å›³ã®ç¤ºã™ã¹ãå†…å®¹

### ã€ŒçŠ¶æ…‹é·ç§»å›³ã€ã¨ã¯
çŠ¶æ…‹é·ç§»å›³ã¨ã¯æ¬¡ã®ã‚ˆã†ãªã‚‚ã®ã¨è€ƒãˆã¦ã„ã¾ã™
* ã‚·ã‚¹ãƒ†ãƒ ã®æŒ¯ã‚‹èˆã„ã‚’çŠ¶æ…‹ã«ã‚ˆã£ã¦åŒºåˆ‡ã£ã¦ç¤ºã™
* ã€ŒçŠ¶æ…‹ã€ã®ã€Œé·ç§»ã€ã‚’è¡¨ã™ã€Œå›³ã€
* ã€Œé·ç§»ã€ã¯ã€Œã‚¤ãƒ™ãƒ³ãƒˆã€ã«ã‚ˆã‚Šé§†å‹•ã™ã‚‹

å…·ä½“çš„ã«ã©ã®ã‚ˆã†ãªã‚‚ã®ã‚’ç¤ºã™ã“ã¨ãŒã§ãã‚‹ã®ã‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚å½“åˆç¤ºã—ãŸã‚·ã‚¹ãƒ†ãƒ ã¯è¤‡é›‘ãªãŸã‚ã€ç°¡å˜ãªä¾‹ã¨ã—ã¦ã€ãŠè…¹ãŒã™ã„ãŸçŠ¶æ…‹ã‚’ã‚‚ã¨ã«è€ƒãˆã¦ã¿ã¾ã™

ãŠè…¹å…·åˆçŠ¶æ…‹ã«ã¯æ¬¡ã®3çŠ¶æ…‹ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã«ã—ã¾ã™
* ãŠè…¹ãŒã™ã„ã¦ã„ãªã„
* ã™ã“ã—ãŠè…¹ãŒã™ã„ãŸ
* ã¨ã¦ã‚‚ãŠè…¹ãŒã™ã„ãŸ

ã€Œã¨ã¦ã‚‚ãŠè…¹ãŒã™ã„ãŸã‹ã‚‰ã”é£¯ã‚’é£Ÿã¹ã‚‹ã€ã¨ã„ã†å ´åˆã¯æ¬¡ã®ã‚ˆã†ã«ç¤ºã—ã¾ã™
* ã‚¤ãƒ™ãƒ³ãƒˆï¼šã€Œã¨ã¦ã‚‚ãŠè…¹ãŒã™ã„ãŸã€ãŒç™ºç”Ÿ
* é·ç§»ï¼šã€ŒãŠè…¹ãŒã™ã„ã¦ã„ãªã„çŠ¶æ…‹ã€â†’ã€Œã¨ã¦ã‚‚ãŠè…¹ãŒã™ã„ã¦ã„ã‚‹çŠ¶æ…‹ã€ã¸å¤‰åŒ–
* æŒ¯ã‚‹èˆã„ï¼šã€Œã¨ã¦ã‚‚ãŠè…¹ãŒã™ã„ã¦ã„ã‚‹çŠ¶æ…‹ã€ã«å¤‰åŒ–ã—ãŸãŸã‚ã€Œã”é£¯ã‚’é£Ÿã¹ã‚‹ã€

â€»çŠ¶æ…‹é·ç§»å›³ã®è¦ç´ ã¨ã—ã¦entry, do, exitãªã©ãŒã‚ã‚Šã¾ã™ãŒï¼Œ(è¦‹ãŸã¾ã¾ã§ã™ã—)ä»Šå›ã¯å‰²æ„›ã—ã¾ã™

ã“ã‚Œã‚’çŠ¶æ…‹é·ç§»å›³ã§ç¤ºã™ã¨æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™

:::details plantuml
```plantuml
[*] --> ãŠè…¹ãŒã™ã„ã¦ã„ãªã„
ãŠè…¹ãŒã™ã„ã¦ã„ãªã„ --> ã¨ã¦ã‚‚ãŠè…¹ãŒã™ã„ã¦ã„ã‚‹ : ã¨ã¦ã‚‚ãŠè…¹ãŒã™ã„ãŸ
ã¨ã¦ã‚‚ãŠè…¹ãŒã™ã„ã¦ã„ã‚‹ --> ãŠè…¹ãŒã™ã„ã¦ã„ãªã„ : ã”é£¯ã‚’é£Ÿã¹ã‚‹
ãŠè…¹ãŒã™ã„ã¦ã„ãªã„ --> ã™ã“ã—ãŠè…¹ãŒã™ã„ã¦ã„ã‚‹ : ã™ã“ã—ãŠè…¹ãŒã™ã„ãŸ
ã™ã“ã—ãŠè…¹ãŒã™ã„ã¦ã„ã‚‹ --> ãŠè…¹ãŒã™ã„ã¦ã„ãªã„ : ãŠã‚„ã¤ã‚’é£Ÿã¹ã‚‹
```
:::
![](/images/statemachine_from_antipattern/hungry_1.png)

ã“ã“ã§ç–‘å•ãŒå‡ºã¦ãã‚‹ã®ã§ã™ãŒ(å‡ºã¦ãã‚‹ã“ã¨ã«ã—ã¾ã™)ã€ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã¨ã®é•ã„ãŒã‚ã‹ã‚‰ãªããªã‚Šã¾ã—ãŸã€‚ã•ã¦æœ¬å½“ã«çŠ¶æ…‹é·ç§»å›³ã‚’æãã“ã¨ãŒæ­£ã—ã„ã®ã§ã—ã‚‡ã†ã‹

ä½•ãŒé•ã„çŠ¶æ…‹é·ç§»å›³ã‚’ä½¿ç”¨ã™ã‚‹ã®ã‹ã€ã§ã™ãŒç§ã¯ç¤ºã—ãŸã„ã‚‚ã®/ç¤ºã—æ–¹ã®å·®ã¨æ‰ãˆã¾ã—ãŸ

ä»Šå›ã®å†…å®¹ã ã¨æ¬¡ã®ã‚ˆã†ãªãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã‚’æ›¸ãã“ã¨ãŒã§ãã¾ã™
:::details plantuml
```plantuml
start

:ãŠè…¹å…·åˆã‚’èª¿æŸ»ã™ã‚‹;
if (ãŠè…¹å…·åˆçŠ¶æ…‹) then (ã¨ã¦ã‚‚ã™ã„ã¦ã„ã‚‹)
    :ã”é£¯ã‚’é£Ÿã¹ã‚‹;
    :çŠ¶æ…‹ã‚’ãŠè…¹ãŒã™ã„ã¦ã„ãªã„ã«å¤‰æ›´;
else if(ãŠè…¹å…·åˆçŠ¶æ…‹) then (ã™ã“ã—ã™ã„ã¦ã„ã‚‹)
    :ãŠã‚„ã¤ã‚’é£Ÿã¹ã‚‹;
    :çŠ¶æ…‹ã‚’ãŠè…¹ãŒã™ã„ã¦ã„ãªã„ã«å¤‰æ›´;
else (ãŠè…¹ãŒã™ã„ã¦ã„ãªã„)
    :ãªã«ã‚‚ã—ãªã„;
endif

end
```
:::
![](/images/statemachine_from_antipattern/hungry_2.png)

ã“ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã®ã€Œé–‹å§‹ã€ã¨ã€Œçµ‚äº†ã€ãŒã©ã“ã«ç¹‹ãŒã£ã¦ã„ã‚‹ã®ã‹ã‚’è€ƒãˆã¦ã¿ã¾ã™

ãŠè…¹å…·åˆçŠ¶æ…‹ã‹ã‚‰é€¸è„±ã—ã¦ã‚‚ã†å°‘ã—ç²’åº¦ã®ç²—ã„å›³ã§è¦‹ã‚‹ã¨ä¾‹ãˆã°æ¬¡ã®ã€Œç©ºè…¹çŠ¶æ…‹ã®ç¢ºèªã€éƒ¨åˆ†ã«å½“ã¦ã¯ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™

:::details plantuml
```plantuml
start

:èµ·åºŠ;
#Mistyrose:ç©ºè…¹çŠ¶æ…‹ã®ç¢ºèª;
:å‡ºç™ºæº–å‚™;

end
```
:::
![](/images/statemachine_from_antipattern/hungry_3.png)
å§‹ã‚ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã¯ç©ºè…¹çŠ¶æ…‹ã®ç¢ºèªã®æŒ¯ã‚‹èˆã„ã‚’ç¤ºã—ã¦ã„ãŸã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸ

ã‚ˆã£ã¦ã€ŒãŠè…¹ãŒã™ã„ãŸçŠ¶æ…‹ã€ã®æŒ¯ã‚‹èˆã„ã‚’ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã«ã‚ˆã‚Šç¤ºã™ã“ã¨ã¯ã§ãã€ç‰¹ã«å•é¡Œã‚‚ãªã„ã‚ˆã†ã«æ€ãˆã¾ã™

ãŸã ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã§ç¤ºã™ã¨æ¬¡ã®ã‚ˆã†ãªã“ã¨ãŒã‚ã‚‹ãŸã‚å°‘ã—å¾®å¦™ã«æ„Ÿã˜ã‚‰ã‚Œã¾ã™
* çŠ¶æ…‹ã®å¤‰åŒ–ãŒã¾ã¨ã¾ã£ã¦ã„ãªã„ãŸã‚ã©ã“ã‚’ã¿ã‚Œã°çŠ¶æ…‹ãŒå¤‰åŒ–ã™ã‚‹ã®ã‹ã‚’è¿½ã†ã®ãŒå¤§å¤‰
  * ã€Œã¨ã¦ã‚‚ã™ã„ã¦ã„ã‚‹ã€çŠ¶æ…‹ã‹ã‚‰ã€Œã™ã“ã—ã™ã„ã¦ã„ã‚‹ã€çŠ¶æ…‹ã¸å¤‰åŒ–ã™ã‚‹ã®ã‹ã©ã†ã‹ãªã©
* çŠ¶æ…‹ã®å¤‰åŒ–è‡ªä½“ã‚‚ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã¨ã—ã¦å®šç¾©ã™ã‚‹å¿…è¦ãŒã‚ã‚Šå†—é•·
  * ã€ŒçŠ¶æ…‹ã‚’ãŠè…¹ãŒã™ã„ã¦ã„ãªã„ã«å¤‰æ›´ã€
* çŠ¶æ…‹ã®å¤‰åŒ–ã‚‚ç¤ºã™ã“ã¨ã¯ã§ãã‚‹ãŒï¼Œãã“ã¨ã¯é•ã†ç®‡æ‰€ã‚’ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã§ã¯è¦‹ãŸã„(ã®ã§ã‚ˆã‚Šç²’åº¦ã®ç²—ã„å›³ãŒæ¬²ã—ããªã‚‹ã€ã¯ãš)

ã§ã¯ãªãœã€ŒçŠ¶æ…‹ã®å¤‰åŒ–ã€ã«ç€ç›®ã—ã¦è¡¨ç¾ã—ãŸããªã‚‹ã®ã§ã—ã‚‡ã†ã‹ã€‚
çŠ¶æ…‹é·ç§»å›³ã¯ã€ŒçŠ¶æ…‹ã®å¤‰åŒ–ã€ã€ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã¯ã€ŒæŒ¯ã‚‹èˆã„ã®æµã‚Œã€ã‚’ç¤ºã—ã¦ã„ã‚‹ã¨è€ƒãˆãŸå ´åˆ
ã€ŒçŠ¶æ…‹ã®å¤‰åŒ–ã€ã¯ã€ŒæŒ¯ã‚‹èˆã„ã®æµã‚Œã€ã®å¿…è¦æ¡ä»¶ã«ãªã£ã¦ã„ã‚‹ã“ã¨ãŒå¤šã„ã¨æ€ã„ã¾ã™ã€‚
ãã®ãŸã‚çŠ¶æ…‹ã®ã»ã†ãŒã‚·ã‚¹ãƒ†ãƒ ã‚’è¡¨ã™ã®ã«ã‚ˆã‚Šå¤§ããªæ„å‘³ã‚’æŒã¤ãŸã‚
ã“ã®ã€ŒçŠ¶æ…‹ã®å¤‰åŒ–ã€ã§ã‚·ã‚¹ãƒ†ãƒ ã‚’è€ƒãˆã‚‹ã¨ã€å¤‰åŒ–ã«å¼·ããªã‚‹ãŸã‚
ã¨æ€ã„ã¾ã—ãŸã€‚

ã‚ˆã£ã¦çŠ¶æ…‹é·ç§»å›³ã«ä»˜éšã—ã¦ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆãŒã‚ã‚‹ã“ã¨è‡ªä½“ã¯å•é¡ŒãŒãªã„ã®ã§ã—ã‚‡ã†ãŒã€çŠ¶æ…‹ã«ç€ç›®ã—ã¦åŒºåˆ‡ã‚‹ã“ã¨ãŒã§ãã‚‹éƒ¨åˆ†ã¯çŠ¶æ…‹é·ç§»å›³ã§ç¤ºã›ã‚‹ã‚ˆã†ã«è¨­è¨ˆã‚’ã™ã‚‹ã“ã¨ãŒæ±‚ã‚ã‚‰ã‚Œã¦ã„ã‚‹ã¨è€ƒãˆã¾ã—ãŸã€‚

ä»¥ä¸Šã‚ˆã‚ŠçŠ¶æ…‹ã®é·ç§»ã¯çŠ¶æ…‹é·ç§»å›³ã§ç¤ºã™ã“ã¨ãŒé©åˆ‡ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã®ã§ã€æ¬¡ã‹ã‚‰çŠ¶æ…‹é·ç§»å›³ã§ç¤ºã—ãŸã„ã“ã¨ã‚’ã€Œç¤ºã™ã¹ãå¯¾è±¡(ãªã«)ã€ã¨ã€Œç¤ºã™ã¹ãç¯„å›²(ã©ã“ã¾ã§)ã€ã‹ã‚‰è€ƒãˆã¦ã„ãã¾ã™

### ãªã«ã‚’ã©ã“ã¾ã§çŠ¶æ…‹é·ç§»å›³ã§ç¤ºã™ã¹ããªã®ã‹
ãã®åã®é€šã‚Š
* ãªã«ï¼šã€ŒçŠ¶æ…‹ã€ã®ã€Œé·ç§»ã€
* ã©ã“ã¾ã§ï¼šã€ŒçŠ¶æ…‹ã€ã‚’ã€Œé·ç§»ã€ã•ã›ã‚‹ã®ã«å¿…è¦ãªã¨ã“ã‚ã¾ã§
ã‚’ç¤ºã—ã¾ã™ã€ãŒã“ã‚Œã§ã¯å›°ã‚‹ãŸã‚ã‚‚ã†å°‘ã—æ˜ã‚Šä¸‹ã’ã¦è€ƒãˆã¦ã¿ã¾ã™

ä»Šå›ã¯å…ˆã»ã©ã®ãŠè…¹å…·åˆçŠ¶æ…‹ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã«å¯¾ã—ã¦ã€æŒ¯ã‚‹èˆã„ã‚’è¿½åŠ ã—ã¦ã¿ã¾ã™ã€‚

:::details plantuml
```plantuml
start

if (ãŠè…¹å…·åˆçŠ¶æ…‹) then (ã¨ã¦ã‚‚ã™ã„ã¦ã„ã‚‹)
    #Mistyrose:ã‚¹ãƒ¼ãƒ‘ãƒ¼ã¸è¡Œãé£Ÿæã‚’è³¼å…¥ã™ã‚‹;
    #Mistyrose:èª¿ç†ã™ã‚‹;
    :ã”é£¯ã‚’é£Ÿã¹ã‚‹;
    :çŠ¶æ…‹ã‚’ãŠè…¹ãŒã™ã„ã¦ã„ãªã„ã«å¤‰æ›´;
else if(ãŠè…¹å…·åˆçŠ¶æ…‹) then (ã™ã“ã—ã™ã„ã¦ã„ã‚‹)
    #Mistyrose:ã‚³ãƒ³ãƒ“ãƒ‹ã¸è¡ŒããŠã‚„ã¤ã‚’è³¼å…¥ã™ã‚‹;
    :ãŠã‚„ã¤ã‚’é£Ÿã¹ã‚‹;
    :çŠ¶æ…‹ã‚’ãŠè…¹ãŒã™ã„ã¦ã„ãªã„ã«å¤‰æ›´;
else (ãŠè…¹ãŒã™ã„ã¦ã„ãªã„)
    :ãªã«ã‚‚ã—ãªã„;
endif

end
```
:::
![](/images/statemachine_from_antipattern/hungry_adv_1.png)

ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã¨ã—ã¦ã¯é©åˆ‡ãªè¡¨è¨˜ã®ã¾ã¾ã§ã™ã€‚ã”é£¯ã‚’é£Ÿã¹ã‚‹ãŸã‚ã«ã¯é£Ÿæ/èª¿ç†ãŒå¿…è¦ãªãŸã‚ãƒ•ãƒ­ãƒ¼ã«èµ·ã“ã™ã“ã¨ã¯æ„å‘³ãŒã‚ã‚‹å ´åˆãŒå­˜åœ¨ã—ã¾ã™(ç¤ºã—ãŸã„ã“ã¨ã«ã‚ˆã‚‹)

ã§ã™ãŒçŠ¶æ…‹é·ç§»ã¨ã—ã¦ã¯ã©ã†ã§ã—ã‚‡ã†ã‹ã€‚ä»Šå›è¿½åŠ ã—ãŸæƒ…å ±ã¯ç„¡ãã¨ã‚‚æˆç«‹ã—ã¾ã™ã—ã€ã‚€ã—ã‚ã©ã®æŒ™å‹•ã«ã‚ˆã‚ŠçŠ¶æ…‹é·ç§»ã‚’ã—ã¦ã„ã‚‹ã®ã‹ãŒåˆ†ã‹ã‚Šã¥ã‚‰ããªã£ã¦ã—ã¾ã„ã¾ã—ãŸ

ã€Œã¨ã¦ã‚‚ã™ã„ã¦ã„ã‚‹ã€éš›ã«çŠ¶æ…‹ã‚’ã€ŒãŠè…¹ãŒã™ã„ã¦ã„ãªã„ã€ã«å¤‰æ›´ã§ãã‚‹ç†ç”±ãŒã€ã€Œé£Ÿæã‚’è³¼å…¥ã™ã‚‹ã€ã€ã€Œèª¿ç†ã™ã‚‹ã€ã€ã€Œã”é£¯ã‚’é£Ÿã¹ã‚‹ã€ã®ã©ã‚Œã«ã‚ˆã‚‹ã‚‚ã®ãªã®ã‹ãŒã‚ã‹ã‚Šã¾ã›ã‚“
ã€‚(ç„¡ç†ã¯ã‚ã‚Šã¾ã™ãŒ)é£Ÿæã®è³¼å…¥å¾Œã«äº‹æ•…ã«ã‚ã£ãŸå ´åˆã®å‡¦ç†ã‚’è¿½åŠ ã™ã‚‹æ™‚ã¯ã€ãŠè…¹å…·åˆçŠ¶æ…‹ã®å‡¦ç†ã‚’ã©ã†ã™ã‚Œã°ã‚ˆã„ã®ã§ã—ã‚‡ã†ã‹ã€‚å®Ÿã¯è³¼å…¥ã—ãŸã ã‘ã§è…¹ãŒè†¨ã‚Œã€èª¿ç†ä»¥é™ã¯é£Ÿæã‚’ç„¡é§„ã«ã—ãªã„ãŸã‚ã«å®Ÿæ–½ã—ã¦ã„ã‚‹ã ã‘ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“(ãã‚Œã¯ãªã„)

ã¤ã¾ã‚ŠçŠ¶æ…‹é·ç§»å›³ã§ã¯ã€çŠ¶æ…‹ã‚’é·ç§»ã•ã›ã‚‹éƒ¨åˆ†ã«ç€ç›®ã—ãã‚Œä»¥å¤–ã®è¦ç´ ã¯è¨˜è¼‰ã—ãªã„ã“ã¨ã§çŠ¶æ…‹ã®é·ç§»ã‚’åˆ†ã‹ã‚Šã‚„ã™ãã—ã¦ã„ã¾ã™

ã‚†ãˆã«çŠ¶æ…‹é·ç§»ã‚’ç¤ºã™ã®ã«çŠ¶æ…‹é·ç§»å›³ãŒç”¨ã„ã‚‰ã‚Œã‚‹ã“ã¨ãŒå¤šã„ã®ã§ã—ã‚‡ã†

## æ®‹å¿µãªçŠ¶æ…‹é·ç§»å›³ã®æ”¹å–„
ã•ã¦å‰é …ã¾ã§ã§æ¬¡ã®è¦ç´ ãŒçŠ¶æ…‹é·ç§»å›³ã«å¿…è¦ãªã®ã ã¨ã„ã†ã“ã¨ã¨ãªã‚Šã¾ã—ãŸ
* çŠ¶æ…‹ã®é·ç§»ã¯çŠ¶æ…‹é·ç§»å›³ã§ç¤ºã™ã“ã¨ãŒè‰¯ã„
* çŠ¶æ…‹é·ç§»å›³ã¯çŠ¶æ…‹ã‚’é·ç§»ã•ã›ã‚‹éƒ¨åˆ†ã«ç€ç›®ã™ã‚‹ã“ã¨ãŒè‰¯ã„

ã“ã®å‰æã‚’ã‚‚ã¨ã«æ®‹å¿µçŠ¶æ…‹ã‚’è¦‹ã¦ã„ãã¾ã™

### ã©ã“ãŒæ®‹å¿µã§ã©ã†ã™ã‚Œã°è‰¯ã„ã®ã‹
ä¸€è¨€ã§ã„ã†ã¨ã€ŒçŠ¶æ…‹é·ç§»ã€ã«é–¢ä¿‚ã®ãªã„éƒ¨åˆ†å…¨éƒ¨ã€ãªã®ã§ã™ãŒã„ã‚ã„ã‚ã¨è©°ã‚è¾¼ã¿ã™ãã¦ã„ã¾ã™ãŒæ¬¡ã®å†…å®¹ã‚’è¦‹ã¦ã„ãã¾ã™

* çŠ¶æ…‹é·ç§»ã«ã¯é–¢ä¿‚ã®ãªã„å‡¦ç†
* ãƒ•ãƒ­ãƒ¼ã‚’ç¤ºã—ã¦ã„ã‚‹
* ãã‚‚ãã‚‚å„ãƒãƒ¼ãƒ‰ãŒçŠ¶æ…‹ã§ã¯ãªã„

ã¾ãšæ°—ã«ãªã‚‹ã“ã¨ã¯ã€ãƒãƒ¼ãƒ‰ã‚„ã‚¨ãƒƒã‚¸ã«ã‹ã‹ã‚ã‚‰ãšãã‚‚ãã‚‚çŠ¶æ…‹ã¨çŠ¶æ…‹ã«é–¢ä¿‚ã®ãªã„ã‚‚ã®ãŒæ··åœ¨ã—ã¦ã„ã‚‹ç‚¹ã§ã™ã€‚åˆ†é¡ã—ãªãŠã™ã“ã¨ã§ä»Šå¾Œã®ä¿®æ­£ã‚’è€ƒãˆã¦ã„ãã¾ã™

![](/images/statemachine_from_antipattern/antistate_2.png)

ä»Šå›ã®å›³ã¯æ¬¡ã®ã‚ˆã†ã«åˆ†é¡ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã—ãŸ

* èµ¤æ 
  * çŠ¶æ…‹ã«ã‹ã‹ã‚ã‚‰ãšå¿…è¦ãªã€Œå‡¦ç†ã€(å‡¦ç†ã®æµã‚Œã‚’ç¤ºã™ã“ã¨ã¨ã—ã¦ã¯å¿…è¦)
  * çŠ¶æ…‹é·ç§»å›³ã¨ã—ã¦ã¯ä¸è¦ã€ã“ã®éƒ¨åˆ†ã‚’ç¤ºã™å ´åˆã¯åˆ¥é€”ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£å›³ã‚’æ›¸ã„ãŸã»ã†ãŒåˆ†ã‹ã‚Šã‚„ã™ã„
* ç·‘æ 
  * ãƒãƒ¼ãƒ‰ãŒç‰¹å®šã®çŠ¶æ…‹ã§å®Ÿæ–½ã™ã‚‹å‡¦ç†ã§åˆ†é¡ã•ã‚Œã¦ã„ã‚‹
  * çŠ¶æ…‹ã®é·ç§»ã‚’ç¤ºã—ãŸã„ãŸã‚ã€çŠ¶æ…‹ã§åˆ†é¡ã™ã‚‹å¿…è¦ãŒã‚ã‚‹

ã¾ãšèµ¤æ ã§ç¤ºã—ãŸã„å‡¦ç†ã®æµã‚Œã¯ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£å›³ã«å¤‰æ›ã—ã¾ã™
æ¬¡ã«ç·‘æ ã®æ•´ç†ã¨ã—ã¦çŠ¶æ…‹ã§ã¯ãªã„ã€Œå£åˆ¤å®šã€ãƒ»ã€Œé«˜é€Ÿç§»å‹•å‡¦ç†ã€ã®å‡¦ç†ã§ã®åŒºåˆ‡ã‚Šã‚’å‰Šé™¤ã—ã¾ã™

:::details plantuml
```plantuml
@startuml
start

partition é«˜é€Ÿç§»å‹•å‡¦ç† {
  if (çŠ¶æ…‹) then (éå£æ¥è§¦çŠ¶æ…‹)
    if (ã‚­ãƒ¼å…¥åŠ›) then (yes)
      :é«˜é€Ÿç§»å‹•;
      :çŠ¶æ…‹ã‚’é«˜é€Ÿç§»å‹•ä¸­ã«å¤‰æ›´;
    else (no)
      :çŠ¶æ…‹ã‚’å£éæ¥è§¦ä¸­ã«å¤‰æ›´;
    endif
  else
  endif
}

partition å£åˆ¤å®š {
  if (æ¥è§¦å¯¾è±¡) then (å£)
    :çŠ¶æ…‹ã‚’å£æ¥è§¦ä¸­ã«å¤‰æ›´;
  else (å£ã§ã¯ãªã„/è§¦ã‚Œã¦ã„ãªã„)
    if (çŠ¶æ…‹) then (ã€Œé«˜é€Ÿç§»å‹•ä¸­ã€ã§ã¯ãªã„)
      :çŠ¶æ…‹ã‚’å£éæ¥è§¦ä¸­ã«å¤‰æ›´;
    endif
  endif
}
end
```
:::
![](/images/statemachine_from_antipattern/refinestate_act1.png)

(çŠ¶æ…‹é·ç§»å›³ã®èª¬æ˜ã®ãŸã‚ã€ã“ã®ç¨‹åº¦ã®å‡¦ç†ãªã‚‰ã°ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£å›³ã«çµã‚‹ã»ã†ãŒè‰¯ã„ã®ã§ã¯?ã¨æ€ã†æ°—æŒã¡ã¯æŠ‘ãˆã¾ã™)

:::details plantuml
```plantuml
@startuml

[*] --> æ¥è§¦å¯¾è±¡ã®åˆ¤å®š
æ¥è§¦å¯¾è±¡ã®åˆ¤å®š --> æ¥è§¦çŠ¶æ…‹ã‚’æ¥è§¦ä¸­ã«å¤‰æ›´ : å£ã§ã‚ã‚‹
æ¥è§¦çŠ¶æ…‹ã‚’æ¥è§¦ä¸­ã«å¤‰æ›´ : entry / çŠ¶æ…‹ã‚’å£æ¥è§¦çŠ¶æ…‹ã«å¤‰æ›´ã™ã‚‹
æ¥è§¦å¯¾è±¡ã®åˆ¤å®š --> [*] : å£ã§ãªã„
æ¥è§¦çŠ¶æ…‹ã‚’æ¥è§¦ä¸­ã«å¤‰æ›´ --> [*]

[*] --> å£æ¥è§¦çŠ¶æ…‹ã®åˆ¤å®š
å£æ¥è§¦çŠ¶æ…‹ã®åˆ¤å®š --> å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ã‚‹ : å£éæ¥è§¦çŠ¶æ…‹
å£æ¥è§¦çŠ¶æ…‹ã®åˆ¤å®š --> å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ãªã„ : å£æ¥è§¦çŠ¶æ…‹

å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ã‚‹ --> é«˜é€Ÿç§»å‹• : ã‚­ãƒ¼å…¥åŠ›ã•ã‚Œã¦ã„ã‚‹
é«˜é€Ÿç§»å‹• : entry / çŠ¶æ…‹ã‚’é«˜é€Ÿç§»å‹•ä¸­ã«ã™ã‚‹
é«˜é€Ÿç§»å‹• --> [*]
å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ã‚‹ --> [*] : ã‚­ãƒ¼å…¥åŠ›ã•ã‚Œã¦ã„ãªã„
å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ãªã„ --> [*]

@enduml

```
:::
![](/images/statemachine_from_antipattern/refinestate_state1.png)

å‡¦ç†ã®åˆ†é¡ãŒç„¡ããªã£ãŸãŸã‚ä¸€æ™‚çš„ã«è¦‹ã¥ã‚‰ããªã‚Šã¾ã™ãŒç¶šã‘ã¾ã™ã€‚ç¶šã„ã¦ãƒãƒ¼ãƒ‰ã®åˆ†é¡ã‚’çŠ¶æ…‹ã«å¤‰æ›´ã—ã¾ã™

ç¾åœ¨ã®å›³ã«ã‚ã‚‹ãƒãƒ¼ãƒ‰, ã‚¨ãƒƒã‚¸ã¯æ¬¡ã®çŠ¶æ…‹ã§åˆ©ç”¨ã—ã¦ã„ã‚‹ã¨åˆ†é¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™
| ãƒãƒ¼ãƒ‰                 | ã‚¨ãƒƒã‚¸                                  | å–ã‚Šã†ã‚‹çŠ¶æ…‹                             |
| ---------------------- | --------------------------------------- | ---------------------------------------- |
| æ¥è§¦å¯¾è±¡ã®åˆ¤å®š         | å£ã§ã‚ã‚‹/å£ã§ãªã„                       | å…¨çŠ¶æ…‹(å‡¦ç†ã®ãŸã‚çŠ¶æ…‹é·ç§»å›³ã«ã¯è¡¨ã‚Œãªã„) |
| æ¥è§¦çŠ¶æ…‹ã‚’æ¥è§¦ä¸­ã«å¤‰æ›´ | -                                       | éæ¥è§¦çŠ¶æ…‹, é«˜é€Ÿç§»å‹•ä¸­                   |
| å£æ¥è§¦çŠ¶æ…‹ã®åˆ¤å®š       | å£éæ¥è§¦çŠ¶æ…‹/å£æ¥è§¦çŠ¶æ…‹                 | å£æ¥è§¦ä¸­, éå£æ¥è§¦çŠ¶æ…‹                   |
| å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ã‚‹       | ã‚­ãƒ¼å…¥åŠ›ã•ã‚Œã¦ã„ã‚‹/ã‚­ãƒ¼å…¥åŠ›ã•ã‚Œã¦ã„ãªã„ | å£éæ¥è§¦çŠ¶æ…‹, é«˜é€Ÿç§»å‹•ä¸­                 |
| å…¥åŠ›ã‚’å—ã‘ä»˜ã‘ãªã„     | å£æ¥è§¦çŠ¶æ…‹                              | å£æ¥è§¦çŠ¶æ…‹                               |
| é«˜é€Ÿç§»å‹•               | -                                       | å£éæ¥è§¦çŠ¶æ…‹, é«˜é€Ÿç§»å‹•ä¸­                 |

ã“ã‚Œã‚’è¸ã¾ãˆã¦çŠ¶æ…‹ã‚’ã‚‚ã¨ã«æ›¸ãå¤‰ãˆã‚‹ã¨æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸ

ãƒãƒ¼ãƒ‰ãŒçŠ¶æ…‹ã‚’ç¤ºã—ï¼Œã‚¨ãƒƒã‚¸ãŒé·ç§»æ¡ä»¶ã¨é·ç§»å…ˆã‚’ç¤ºã™ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã€ŒçŠ¶æ…‹é·ç§»å›³ã€ã¨ã—ã¦ã¯ã“ã‚ŒãŒè‰¯ãçŠ¶æ…‹ã¨æ€ã„ã¾ã™ã€‚å‡¦ç†ã®æµã‚Œã‚’ç¤ºã—ãŸã„å ´åˆã¯å…ˆã«ä½œæˆã—ãŸã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£å›³ã‚’å‡ºã—ã¾ã™

:::details plantuml
```plantuml
@startuml

[*] --> å£éæ¥è§¦çŠ¶æ…‹
å£éæ¥è§¦çŠ¶æ…‹ --> å£æ¥è§¦çŠ¶æ…‹ : æ¥è§¦å¯¾è±¡ãŒå£ã§ã‚ã‚‹
å£æ¥è§¦çŠ¶æ…‹ --> å£éæ¥è§¦çŠ¶æ…‹ : æ¥è§¦å¯¾è±¡ãŒå£ã§ãªã„

å£éæ¥è§¦çŠ¶æ…‹ --> é«˜é€Ÿç§»å‹•çŠ¶æ…‹ : é«˜é€Ÿç§»å‹•ã‚­ãƒ¼ãŒå…¥åŠ›ã•ã‚ŒãŸ
é«˜é€Ÿç§»å‹•çŠ¶æ…‹ --> å£éæ¥è§¦çŠ¶æ…‹ : é«˜é€Ÿç§»å‹•ã‚­ãƒ¼ãŒé›¢ã•ã‚ŒãŸ
é«˜é€Ÿç§»å‹•çŠ¶æ…‹ --> å£æ¥è§¦çŠ¶æ…‹ : å£ã«æ¥è§¦ã—ãŸ

@enduml

```
:::
![](/images/statemachine_from_antipattern/refinestate_state2.png)

## ã¾ã¨ã‚
* çŠ¶æ…‹é·ç§»å›³ã®ãƒãƒ¼ãƒ‰ã¯ã€ŒçŠ¶æ…‹ã€ã«ã™ã‚‹
* çŠ¶æ…‹é·ç§»å›³ã®ã‚¨ãƒƒã‚¸ã«ã¯ã€ŒçŠ¶æ…‹é·ç§»ã€ã—ã‹è¨˜è¼‰ã—ãªã„
* ã‚·ã‚¹ãƒ†ãƒ ã®æµã‚Œã‚‚è¨˜è¼‰ã—ãŸã„å ´åˆã¯ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£å›³ã‚’æ·»ãˆã‚‹

## çµ‚ã‚ã‚Šã«
ã©ã®ã‚ˆã†ã«è€ƒãˆã¦ã¿ã¦ã‚‚å£æ¥è§¦ã¨ç§»å‹•ã®çŠ¶æ…‹ã¯ç‹¬ç«‹ã—ã¦ã„ã‚‹ã®ã§æ„å‘³çš„ã«ãŠã‹ã—ã„
ã¨ã„ã†æ°—æŒã¡ãŒæŠ‘ãˆã‚‰ã‚Œãªã„ã¨ã“ã†ãªã‚Šã¾ã™ã€‚è¨­å•ã«ç„¡ç†ãŒã‚ã‚‹ã‚“ã§ã™ã‚ˆâ€¦
å£çŠ¶æ…‹ã¨ç§»å‹•çŠ¶æ…‹ã¯ç‹¬ç«‹ã—ã¦ãŠã‚Šã€ç§»å‹•å‡¦ç†ã§å£çŠ¶æ…‹ã‚’å‚ç…§ã™ã‚‹ã ã‘ã§è‰¯ã„

:::details plantuml
```plantuml
@startuml

state å£çŠ¶æ…‹ {
[*] --> å£éæ¥è§¦çŠ¶æ…‹
å£éæ¥è§¦çŠ¶æ…‹ --> å£æ¥è§¦çŠ¶æ…‹ : æ¥è§¦å¯¾è±¡ãŒå£ã§ã‚ã‚‹
å£æ¥è§¦çŠ¶æ…‹ --> å£éæ¥è§¦çŠ¶æ…‹ : æ¥è§¦å¯¾è±¡ãŒå£ã§ãªã„
}

state ç§»å‹•çŠ¶æ…‹ {
[*] --> éé«˜é€Ÿç§»å‹•çŠ¶æ…‹
éé«˜é€Ÿç§»å‹•çŠ¶æ…‹ --> é«˜é€Ÿç§»å‹•çŠ¶æ…‹ : é«˜é€Ÿç§»å‹•ã‚­ãƒ¼ãŒå…¥åŠ›ã•ã‚ŒãŸ
é«˜é€Ÿç§»å‹•çŠ¶æ…‹ --> éé«˜é€Ÿç§»å‹•çŠ¶æ…‹ : é«˜é€Ÿç§»å‹•ã‚­ãƒ¼ãŒé›¢ã•ã‚ŒãŸ
é«˜é€Ÿç§»å‹•çŠ¶æ…‹ --> éé«˜é€Ÿç§»å‹•çŠ¶æ…‹ : å£æ¥è§¦çŠ¶æ…‹ã§ã‚ã‚‹
}

@enduml

```
:::
![](/images/statemachine_from_antipattern/refinestate_state3.png)

:::details plantuml
```plantuml
@startuml
start

partition é«˜é€Ÿç§»å‹•å‡¦ç† {
  if (<font color="red">å£</font>çŠ¶æ…‹) then (éå£æ¥è§¦çŠ¶æ…‹)
    if (ã‚­ãƒ¼å…¥åŠ›) then (yes)
      :é«˜é€Ÿç§»å‹•;
      :<font color="red">ç§»å‹•</font>çŠ¶æ…‹ã‚’é«˜é€Ÿç§»å‹•ä¸­ã«å¤‰æ›´;
    else (no)
      :<font color="red">ç§»å‹•</font>çŠ¶æ…‹ã‚’éé«˜é€Ÿç§»å‹•ä¸­ã«å¤‰æ›´;
    endif
  else
  endif
}

partition å£åˆ¤å®š {
  if (æ¥è§¦å¯¾è±¡) then (å£)
    :<font color="red">å£</font>çŠ¶æ…‹ã‚’å£æ¥è§¦ä¸­ã«å¤‰æ›´;
  else (å£ã§ã¯ãªã„/è§¦ã‚Œã¦ã„ãªã„)
    :<font color="red">å£</font>çŠ¶æ…‹ã‚’å£éæ¥è§¦ä¸­ã«å¤‰æ›´;
  endif
}
end
@enduml
```
:::
![](/images/statemachine_from_antipattern/refinestate_act2.png)

